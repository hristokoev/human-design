---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import CustomForm from "../components/sections/contact/Contact02.tsx";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const firstName = data.get("firstName");
    const lastName = data.get("lastName");
    const email = data.get("email");
    const phone = data.get("phone");
    const experienceWithHumanDesign = data.get("experienceWithHumanDesign");
    const service = data.get("service");
    const birthDate = data.get("birthDate");
    const birthTime = data.get("birthTime");
    const birthCountry = data.get("birthCountry");
    const birthCity = data.get("birthCity");
    const message = data.get("message");
    const gdpr = data.get("gdpr");

    if (!gdpr) {
      throw new Error("Musíš souhlasit s podmínkami");
    }

    const response = await fetch(import.meta.env.COCKPIT_REST_URL + "/content/item/orders", {
      method: "POST",
      body: JSON.stringify({
        data: {
          firstName,
          lastName,
          email,
          phone,
          experienceWithHumanDesign,
          service,
          birthDate,
          birthTime,
          birthCountry,
          birthCity,
          message,
        },
      }),
      headers: {
        "Content-Type": "application/json",
        "api-key": import.meta.env.COCKPIT_API_KEY,
      },
    }).then((res) => {

// Clear data 
			

		});


  } catch (error) {
    console.error(error);
  }
}

const { method } = Astro.request;
const { status, statusText } = Astro.response;
---

<Layout title="Mám zájem o rozvoj podnikání" description="">
  {
    method == "POST" && status == 200 ? (
      <section class="text-petroleum-900">
        <div class="container">
          <div class="py-32">
            <div class="flex flex-col">
              <div
                class="flex flex-col justify-center items-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative"
                role="alert"
              >
                <strong class="font-bold">Děkujeme!</strong>
              </div>
            </div>
          </div>
        </div>
      </section>
    ) : (
      <CustomForm />
    )
  }
</Layout>
