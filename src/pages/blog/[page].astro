---
import fetchData from "../../lib/fetchData";
import type FetchData from "../../interfaces/FetchData";
import type BlogPage from "../../interfaces/BlogPage";
import type BlogItem from "../../interfaces/BlogItem";
import type CategoryItem from "../../interfaces/CategoryItem";
import Layout from "../../layouts/Layout.astro";
import BlogHeader from "../../components/sections/blog/BlogHeader.tsx";
import BlogGrid from "../../components/sections/blog/BlogGrid.tsx";
import BlogPagination from "../../components/sections/blog/BlogPagination.tsx";
import Subscribe from "../../components/sections/blog/Subscribe.tsx";

export async function getStaticPaths({ paginate }: any) {
  const queryIds = `
		query Query {
			blogModel {
				title
			}
		}
	`;

  const { blogModel }: FetchData = await fetchData(queryIds);

  if (!blogModel) {
    return [];
  }

  return paginate(blogModel, { pageSize: 12 });
}

const { page } = Astro.props as { page: BlogPage };

const queryPost = `
query Query($limit: Int, $skip: Int, $sort: JsonType) {
  blogModel(limit: $limit, skip: $skip, sort: $sort) {
		_id
		_created
		title
		perex
		category
		image
		author {
			name
			title
			photo
		}
	}
	catsModel {
		_id
		title
		url
	}
}
`;

const variables = {
  limit: page.size,
  skip: page.start,
	sort: { _created: -1 },
};

const { blogModel: posts, catsModel: cats }: FetchData = await fetchData(queryPost, variables);
---

<Layout title={`Blog - Stranka ${page.currentPage} - Human Design`} description="">
	<BlogHeader />
	<BlogGrid posts={posts as BlogItem[]} cats={cats as CategoryItem[]} />
	<BlogPagination />
	<Subscribe />
</Layout>